# 手写识别测试指南

## 🚀 快速测试步骤

### 1. 运行应用
```bash
# 在 Android Studio 中
1. 点击 "Run" 按钮（或按 Shift+F10）
2. 选择目标设备（真机或模拟器）
3. 等待应用安装和启动
```

### 2. 进入手写识别界面

根据应用的具体入口，通常有以下方式：
- 在笔记编辑界面，点击手写输入按钮
- 或者在主界面找到手写识别入口

### 3. 测试手写识别

#### 基础测试
1. **打开手写输入界面**
2. **启用边写边识别**（如果有关闭，请打开开关）
3. **书写测试文字**：
   - 先写一个简单的字，如："一"、"二"、"三"
   - 然后写一个词，如："你好"、"测试"
   - 最后写一个句子，如："这是一个测试"

#### 测试要点
- ✅ **抬笔后自动识别**：写完一个字后，抬笔等待约 0.8 秒，应该自动识别
- ✅ **识别结果显示**：识别结果应该显示在上方的文本框中
- ✅ **字体美化**：识别后的文字应该以选定的字体显示

## 📊 查看日志（重要）

### 在 Android Studio 中查看 Logcat

1. **打开 Logcat**
   - 点击 Android Studio 底部的 "Logcat" 标签
   - 或使用快捷键：`Alt + 6` (Windows) / `Cmd + 6` (Mac)

2. **过滤日志**
   - 在搜索框中输入：`DigitalInkRecognition`
   - 或者输入：`HandwritingRecognition`

3. **关键日志信息**

#### 初始化日志
```
✅ Digital Ink Recognition 初始化成功（中文模型）
模型标识: zh-Hani-CN
```

#### 模型下载日志（首次使用）
```
模型未下载，开始下载中文手写识别模型...
这可能需要一些时间，请保持网络连接
✅ 模型下载成功，可以开始识别
```

#### 识别日志
```
识别成功: 你好 (置信度: 0.95)
其他候选结果:
  [2] 你好 (置信度: 0.03)
  [3] 你好 (置信度: 0.02)
```

#### 如果回退到 OCR（说明 Digital Ink 未工作）
```
Digital Ink Recognition 初始化失败，将使用 OCR
使用 OCR 识别（将笔画转换为图片）
```

## 🔍 验证是否使用了 Digital Ink Recognition

### 方法 1：查看日志
- ✅ **成功**：看到 "Digital Ink Recognition 识别成功"
- ❌ **失败**：看到 "使用 OCR 识别" 或 "Digital Ink Recognition 初始化失败"

### 方法 2：识别速度
- ✅ **Digital Ink**：识别速度很快（< 100ms）
- ❌ **OCR**：识别速度较慢（> 500ms），需要将笔画转换为图片

### 方法 3：识别准确率
- ✅ **Digital Ink**：识别准确率通常更高，特别是对于手写
- ❌ **OCR**：识别准确率可能较低，特别是对于潦草的字

## 🧪 详细测试用例

### 测试用例 1：单个汉字
1. 写一个简单的字："一"
2. 抬笔等待识别
3. **预期结果**：识别为 "一"，置信度 > 0.8

### 测试用例 2：词语识别
1. 写一个词："你好"
2. 抬笔等待识别
3. **预期结果**：识别为 "你好"，置信度 > 0.7

### 测试用例 3：句子识别
1. 写一个句子："这是一个测试"
2. 抬笔等待识别
3. **预期结果**：识别为完整句子，置信度 > 0.6

### 测试用例 4：连续书写
1. 启用边写边识别
2. 写 "你好"
3. 等待识别并清除
4. 继续写 "世界"
5. **预期结果**：两次识别都成功，结果累积显示

### 测试用例 5：潦草字体
1. 写一个潦草的字
2. **预期结果**：可能识别失败或置信度较低，但应该不会崩溃

## ⚠️ 常见问题排查

### 问题 1：识别结果为空

**检查项**：
1. 查看日志中是否有错误信息
2. 确认笔画数量是否足够（至少 2 个点）
3. 确认模型是否已下载

**解决方法**：
```kotlin
// 查看日志
Log.d(TAG, "笔画数量: ${strokes.size}")
Log.d(TAG, "每个笔画的点数: ${strokes.map { it.points.size }}")
```

### 问题 2：识别准确率低

**检查项**：
1. 查看置信度（应该在 0.5 以上）
2. 查看候选结果（可能第二个结果更准确）
3. 尝试写得更清晰

**解决方法**：
- 写得更慢、更清晰
- 确保笔画完整
- 字与字之间保持适当距离

### 问题 3：模型下载失败

**检查项**：
1. 网络连接是否正常
2. Google Play Services 是否已安装
3. 查看日志中的详细错误信息

**解决方法**：
- 确保设备已安装 Google Play Services
- 检查网络连接
- 查看日志中的错误详情

### 问题 4：回退到 OCR

**检查项**：
1. Digital Ink 是否初始化成功
2. 模型是否已下载
3. 查看日志中的错误信息

**解决方法**：
- 查看初始化日志
- 确认模型下载状态
- 检查是否有异常抛出

## 📝 测试检查清单

- [ ] 应用可以正常启动
- [ ] 可以进入手写识别界面
- [ ] 可以正常书写
- [ ] 抬笔后可以自动识别
- [ ] 识别结果显示正确
- [ ] 日志显示使用了 Digital Ink Recognition（不是 OCR）
- [ ] 模型已成功下载（首次使用时）
- [ ] 识别准确率符合预期
- [ ] 边写边识别功能正常
- [ ] 字体美化功能正常

## 🎯 性能测试

### 识别速度
- **目标**：< 100ms（从抬笔到显示结果）
- **测试方法**：记录识别开始和结束时间

### 识别准确率
- **目标**：简单字 > 90%，复杂字 > 70%
- **测试方法**：写 10 个不同的字，统计识别正确的数量

### 内存使用
- **目标**：识别过程内存增长 < 10MB
- **测试方法**：使用 Android Studio 的 Profiler

## 💡 调试技巧

### 1. 启用详细日志
在 `DigitalInkRecognitionHelper.kt` 中，所有关键步骤都有日志输出。

### 2. 查看候选结果
如果第一个结果不准确，查看日志中的其他候选结果。

### 3. 检查笔画数据
在 `HandwritingInputView.kt` 中，可以添加日志查看笔画数据：
```kotlin
Log.d(TAG, "笔画数量: ${allStrokes.size}")
allStrokes.forEachIndexed { index, stroke ->
    Log.d(TAG, "笔画 $index: ${stroke.points.size} 个点")
}
```

## 🔗 相关文件

- `DigitalInkRecognitionHelper.kt` - Digital Ink 识别实现
- `HandwritingRecognitionService.kt` - 手写识别服务
- `HandwritingInputView.kt` - 手写输入视图
- `ScreenHandwritingActivity.kt` - 手写识别界面


# 字体加载问题排查指南

## 🔍 问题现象

字体文件已放置在 `app/src/main/assets/fonts/calligraphy.ttf`，但显示的不是玄冬楷书字体。

## 📋 排查步骤

### 1. 检查字体文件是否在正确位置

在 Android Studio 的 Project 视图中检查：
```
app/
  └── src/
      └── main/
          └── assets/
              └── fonts/
                  ├── README.md
                  └── calligraphy.ttf  ← 必须存在
```

### 2. 检查字体文件是否被打包到 APK

**方法 1：查看 APK 内容**
1. 构建 APK：**Build → Build Bundle(s) / APK(s) → Build APK(s)**
2. 找到生成的 APK 文件（通常在 `app/build/outputs/apk/debug/`）
3. 将 APK 文件重命名为 `.zip` 并解压
4. 检查 `assets/fonts/calligraphy.ttf` 是否存在

**方法 2：使用 adb 检查**
```bash
# 连接设备后
adb shell
run-as com.gongkao.cuotifupan
ls -la /data/data/com.gongkao.cuotifupan/files/
# 或者检查 APK 内容
```

### 3. 查看 Logcat 日志

运行应用后，在 Logcat 中过滤 `FontType`，应该看到：
- ✅ `成功加载字体: fonts/calligraphy.ttf` - 字体加载成功
- ⚠️ `字体文件 fonts/calligraphy.ttf 不存在` - 字体文件未找到

### 4. 完全卸载并重新安装

字体文件可能被缓存，需要完全卸载：
1. 在手机上：**设置 → 应用 → 错题复盘 → 卸载**
2. 或者使用 adb：
   ```bash
   adb uninstall com.gongkao.cuotifupan
   ```
3. 重新编译并安装

### 5. 检查字体文件格式

确保字体文件：
- ✅ 格式正确（.ttf 或 .otf）
- ✅ 文件未损坏
- ✅ 包含中文字符集

### 6. 验证字体是否真的被使用

在 Logcat 中查看：
- `添加文字到画布` - 显示使用的字体信息
- `绘制文字` - 显示实际绘制的字体

## 🛠️ 常见问题

### 问题 1：字体文件未打包到 APK

**原因**：文件可能没有被正确添加到 assets 目录

**解决**：
1. 在 Android Studio 中，右键点击 `app/src/main/assets/fonts/`
2. 选择 **Synchronize 'fonts'**
3. 重新编译

### 问题 2：字体文件路径错误

**原因**：文件名或路径不正确

**解决**：
- 确保文件名是 `calligraphy.ttf`（小写，不是 `Calligraphy.ttf`）
- 确保路径是 `app/src/main/assets/fonts/calligraphy.ttf`

### 问题 3：字体加载失败但没有报错

**原因**：异常被捕获但字体回退到默认字体

**解决**：
- 查看 Logcat 中的 `FontType` 日志
- 确认是否看到"成功加载字体"的消息

### 问题 4：字体加载成功但显示不对

**原因**：可能是字体文件本身的问题

**解决**：
1. 验证字体文件是否包含要显示的字符
2. 尝试用其他字体文件测试
3. 检查字体文件是否损坏

## ✅ 验证步骤

1. **编译前检查**：
   - [ ] 字体文件在 `app/src/main/assets/fonts/calligraphy.ttf`
   - [ ] 文件名正确（小写，.ttf 扩展名）

2. **编译后检查**：
   - [ ] 查看 Logcat，确认字体加载成功
   - [ ] 在应用中测试"书法"字体

3. **运行时检查**：
   - [ ] 写一个字，识别后选择"书法"字体
   - [ ] 查看画布上的文字是否使用了玄冬楷书字体

## 📝 调试日志

已添加详细的调试日志，在 Logcat 中过滤以下标签：
- `FontType` - 字体加载信息
- `ScreenHandwritingActivity` - 识别和字体应用信息
- `HandwritingInputView` - 文字绘制信息

如果看到 `成功加载字体: fonts/calligraphy.ttf`，说明字体文件已正确加载。

